(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(a){if(a.ep)return;a.ep=!0;const t=s(a);fetch(a.href,t)}})();class x{constructor(e){this.entities=[],this.gravity=8,this.floor_height=20,this.ctx=e,this.canvas=e.canvas}update(e){this.entities.forEach(s=>{this.apply_gravity(s,e),this.apply_bounds(s),s.update(e)})}draw(e){this.entities.forEach(s=>{s.draw(e)})}apply_gravity(e,s){e.velocity.y+=this.gravity,e.position.y+=e.velocity.y*s.seconds_passed}apply_bounds(e){this.limit_left(e),this.limit_right(e),this.limit_bottom(e)}limit_left(e){e.position.x>=0||(e.position.x=0)}limit_right(e){const s=this.canvas.width-e.width;e.position.x<=s||(e.position.x=s)}limit_bottom(e){if(e.velocity.y<0)return;let s=this.canvas.height-this.floor_height-e.height;e.position.y<=s||(e.position.y=s,e.velocity.y=this.gravity,e.is_grounded=!0)}add_entity(e){e.ctx=this.ctx,this.entities.push(e)}add_player(e,s){e.stage=this,this.add_entity(e),e.init(s)}}function k(i){const e=i.file_extension??"png";for(const s in i.states){const r=i.states[s];r.images=[],r.indexes.forEach(a=>{let[t,o]=a,d=t;if(t<o)for(;d<=o;){const h=new Image;h.src=`${i.base_src+d}.${e}`,r.images.push(h),d++}else if(t>o)for(;d>=o;){const h=new Image;h.src=`${i.base_src+d}.${e}`,r.images.push(h),d--}}),r.index=0,typeof r.time>"u"&&(r.time=60)}return i}function b(i,e){const s=i.get_sprite_state(),r=i.sprites_data.scale,{image_width:a,image_height:t}=i.sprites_data;let{x:o,y:d}=i.position;o+=i.sprites_data.offset.x,d+=i.sprites_data.offset.y,e.drawImage(s.images[s.index],0,0,a,t,o,d,a*r,t*r)}function y(i,e){const s=i.get_sprite_state();e.previous<i.animation_timer+s.time||(i.animation_timer=e.previous,s.index++,s.loop?s.index===s.images.length&&(s.index=0):s.index===s.images.length&&(s.index=s.images.length-1,i.animation_end(i.state)))}function j(i){let e="";i.idle=()=>{i.animate("idle"),e=""},i.forward=()=>{e="moving",i.velocity.x=i.move_speed,i.is_jumping||i.animate("forward")},i.backward=()=>{e="moving",i.velocity.x=-i.move_speed,i.is_jumping||i.animate("backward")},i.move_stop=()=>{i.velocity.x=0,i.is_jumping||i.animate("idle")},i.crouch=()=>{e==="moving"&&(i.velocity.x=0),i.animate("crouch")};function s(){i.position.x+=i.velocity.x}i.hooks.update.push(s)}function E(i){const e=i.stage,s=i.stage.canvas,r=s.height-e.floor_height,a=r-140;i.is_grounded=!1,i.is_jumping=!1;let t="";i.jump=()=>{if(i.is_jumping)return;i.is_jumping=!0,i.is_grounded=!1,i.velocity.y=-i.jump_force;let n=i.get_direction();n==="forward"?i.animate("jump_forward"):n==="backward"?i.animate("jump_backward"):i.animate("jump")};function o(){t!=="jumping_up"&&(i.velocity.y>0||(t="jumping_up"))}function d(){t=="jumping_up"&&(i.velocity.y<0||(t="falling_down"))}function h(){t!="falling_down"||i.position.y+i.height<a||(t="landing",i.animate("landing"))}function g(){t=="landing"&&i.is_grounded&&(t="landed",i.is_jumping=!1,i.animate("land"))}function _(){o(),d(),h(),g()}function w(n){n==="land"&&(i.state="idle")}function v(n){n.beginPath(),n.moveTo(0,a),n.lineTo(s.width,a),n.moveTo(0,r),n.lineTo(s.width,r),n.stroke()}i.hooks.update.push(_),i.hooks.animation_end.push(w),i.hooks.draw.push(v)}function S(i,e){e.strokeRect(i.position.x,i.position.y,i.width,i.height)}const p={P1:{KeyA:"backward",KeyD:"forward",KeyS:"crouch",Space:"jump",KeyJ:"attack_1",KeyK:"attack_2",KeyL:"attack_3"}};class L{constructor(e){this.player=e,this.pressing={forward:!1,backward:!1,crouch:!1},document.addEventListener("keydown",s=>{p[e.pid][s.code]&&this[p[e.pid][s.code]]()}),document.addEventListener("keyup",s=>{p[e.pid][s.code]&&this.action_end(p[e.pid][s.code])})}forward(){this.pressing.forward=!0,this.player.forward()}backward(){this.pressing.backward=!0,this.player.backward()}jump(){this.player.jump()}crouch(){this.pressing.crouch=!0,!this.player.is_jumping&&this.player.crouch()}attack_1(){}attack_2(){}attack_3(){}action_end(e){e==="forward"?(this.pressing.forward=!1,this.pressing.backward?this.player.backward():this.player.move_stop()):e==="backward"?(this.pressing.backward=!1,this.pressing.forward?this.player.forward():this.player.move_stop()):e==="crouch"&&(this.pressing.crouch=!1,this.pressing.forward?this.player.forward():this.pressing.backward?this.player.backward():this.player.idle())}}class K{load_sprite(e){this.sprites_data=k(e)}init(e){this.width=this.sprites_data.width,this.height=this.sprites_data.height,this.pid=e.pid??"P1",this.state="idle",this.animation_timer=0,this.position=e.position??{x:0,y:0},this.velocity={x:0,y:0},this.move_speed=2,this.jump_force=700,this.hooks={update:[],animation_end:[],draw:[]},j(this),E(this),new L(this)}update(e){y(this,e),this.hooks.update.forEach(s=>s(e))}draw(e){b(this,e),S(this,e),this.hooks.draw.forEach(s=>s(e))}get_sprite_state(){return this.sprites_data.states[this.state]}animate(e){this.state!==e&&(this.state=e,this.sprites_data.states[this.state].index=0)}animation_end(e){this.hooks.animation_end.forEach(s=>s(e))}get_direction(){return this.velocity.x>0?"forward":this.velocity.x<0?"backward":!1}}const P="spiderman",O="sprites/spiderman/MVC2_SpiderMan_",q=1,A={x:-280,y:-210},C=60,I=80,T=640,$=480,F={idle:{loop:!0,indexes:[[159,167]]},forward:{loop:!0,indexes:[[169,180]]},backward:{loop:!0,indexes:[[180,169]]},jump:{indexes:[[197,189],[189,198]]},jump_forward:{indexes:[[200,210]]},jump_backward:{indexes:[[211,216]]},land:{indexes:[[196,199]]},landing:{indexes:[[193,199]]},crouch:{indexes:[[217,220]]}},M={id:P,base_src:O,scale:q,offset:A,width:C,height:I,image_width:T,image_height:$,states:F};class N extends K{constructor(e={}){super(),this.load_sprite(M)}}const l={previous:0,seconds_passed:0};let c,u,f;function R(){V(),D(),requestAnimationFrame(m)}window.addEventListener("load",R);function D(){f=new x(u),f.add_player(new N,{pid:"P1"})}function J(i){f.update(i)}function Q(i){i.clearRect(0,0,c.width,c.height),f.draw(i)}function V(){c=document.querySelector("canvas"),c.width=1e3,c.height=500,u=c.getContext("2d"),u.strokeStyle="green",u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high"}function m(i){l.seconds_passed=(i-l.previous)/1e3,l.previous=i,requestAnimationFrame(m),J(l),Q(u)}
