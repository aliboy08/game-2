(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();function u(t){const e=t.file_extension??"png";for(const i in t.states){const r=t.states[i];r.images=[];for(let s=r.index_start;s<=r.index_end;s++){const n=new Image;n.src=`${t.base_src+i}/${r.base_file_name}${s}.${e}`,r.images.push(n)}r.index=0,typeof r.time>"u"&&(r.time=60)}return t}function _(t,e){const i=t.get_sprite_state(),r=t.sprites_data.scale,{image_width:s,image_height:n}=t.sprites_data;let{x:d,y:f}=t.position;d+=t.sprites_data.offset.x,f+=t.sprites_data.offset.y,e.drawImage(i.images[i.index],0,0,s,n,d,f,s*r,n*r)}function m(t,e){const i=t.get_sprite_state();e.previous<t.animation_timer+i.time||(t.animation_timer=e.previous,i.index++,i.index===i.images.length&&(i.index=0))}class g{constructor(e){this.sprites_data=u(e.sprites_data),this.width=this.sprites_data.width,this.height=this.sprites_data.height,this.id=e.id??e.sprites_data.id??"",this.state="idle",this.animation_timer=0,this.position=e.position??{x:0,y:0},this.velocity={x:0,y:0},this.move_speed=2,this.jump_force=10}update(e){m(this,e)}draw(e){_(this,e)}get_sprite_state(){return this.sprites_data.states[this.state]}forward(){this.velocity.x=this.move_speed}backward(){this.velocity.x=-this.move_speed}move_stop(){this.velocity.x=0}}const y="spiderman",w="sprites/spiderman/",v=1,x={x:-280,y:-210},k=60,L=80,K=640,S=480,O={idle:{base_file_name:"MVC2_SpiderMan_",index_start:159,index_end:167}},P={id:y,base_src:w,scale:v,offset:x,width:k,height:L,image_width:K,image_height:S,states:O};function E(t,e){e.strokeRect(t.position.x,t.position.y,t.width,t.height)}const q=100;function A(t,e){const i=C(t);i.left<=0?t.position.x=0:i.right>=e.width&&(t.position.x=e.width);let r=e.height-q;i.bottom>=r&&(t.position.y=r,t.velocity.y=0)}function C(t){return{top:t.position.y,right:t.position.x+t.width,bottom:t.position.y+t.height,left:t.position.x,width:t.width,height:t.height}}const $=8;function F(t,e){t.velocity.y+=$,t.position.y+=t.velocity.y*e.seconds_passed}const h={P1:{KeyA:"backward",KeyD:"forward",KeyS:"crouch",Space:"jump",KeyJ:"attack_1",KeyK:"attack_2",KeyL:"attack_3"}};class I{constructor(e){this.player=e,this.pressing={forward:!1,backward:!1},document.addEventListener("keydown",i=>{console.log(i.code),h[e.id][i.code]&&this[h[e.id][i.code]]()}),document.addEventListener("keyup",i=>{h[e.id][i.code]&&this.action_end(h[e.id][i.code])})}forward(){this.pressing.forward=!0,this.player.forward()}backward(){this.pressing.backward=!0,this.player.backward()}jump(){}crouch(){}action_end(e){e==="forward"?(this.pressing.forward=!1,this.pressing.backward?this.player.backward():this.player.move_stop()):e==="backward"&&(this.pressing.backward=!1,this.pressing.forward?this.player.forward():this.player.move_stop())}}const p={previous:0,seconds_passed:0};let a,c,o;function M(){b(),N(),requestAnimationFrame(l)}window.addEventListener("load",M);function N(){o=new g({id:"P1",sprites_data:P}),new I(o)}function b(){a=document.querySelector("canvas"),a.width=1200,a.height=600,c=a.getContext("2d"),c.strokeStyle="green",c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high"}function l(t){p.seconds_passed=(t-p.previous)/1e3,p.previous=t,requestAnimationFrame(l),R(p),D(c)}function R(t){o.update(t),o.position.x+=o.velocity.x,A(o,a),F(o,t)}function D(t){t.clearRect(0,0,a.width,a.height),o.draw(t),E(o,t)}
