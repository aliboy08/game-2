(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(s){if(s.ep)return;s.ep=!0;const t=e(s);fetch(s.href,t)}})();class S{constructor(i){this.entities=[],this.gravity=8,this.floor_height=20,this.ctx=i,this.canvas=i.canvas}update(i){this.entities.forEach(e=>{this.apply_gravity(e,i),this.apply_bounds(e),e.update(i)})}draw(i){this.entities.forEach(e=>{e.draw(i)})}apply_gravity(i,e){i.velocity.y+=this.gravity,i.position.y+=i.velocity.y*e.seconds_passed}apply_bounds(i){this.limit_left(i),this.limit_right(i),this.limit_bottom(i)}limit_left(i){i.position.x>=0||(i.position.x=0)}limit_right(i){const e=this.canvas.width-i.width;i.position.x<=e||(i.position.x=e)}limit_bottom(i){if(i.velocity.y<0)return;let e=this.canvas.height-this.floor_height-i.height;i.position.y<=e||(i.position.y=e,i.velocity.y=this.gravity,i.is_grounded=!0)}add_entity(i){i.ctx=this.ctx,this.entities.push(i)}add_player(i,e){i.stage=this,this.add_entity(i),i.init(e)}}function L(o){const i=o.file_extension??"png";for(const e in o.states){const r=o.states[e];r.images=[],r.indexes.forEach(s=>{let[t,n]=s,a=t;if(t<n)for(;a<=n;){const d=new Image;d.src=`${o.base_src+a}.${i}`,r.images.push(d),a++}else if(t>n)for(;a>=n;){const d=new Image;d.src=`${o.base_src+a}.${i}`,r.images.push(d),a--}}),r.index=0,typeof r.time>"u"&&(r.time=60)}return o}function K(o){o.hooks.update.push(i=>O(o,i)),o.hooks.draw.push(i=>P(o,i))}function P(o,i){const e=o.get_sprite_state(),r=o.sprites_data.scale,{image_width:s,image_height:t}=o.sprites_data;let{x:n,y:a}=o.position;n+=o.sprites_data.offset.x,a+=o.sprites_data.offset.y,i.drawImage(e.images[e.index],0,0,s,t,n,a,s*r,t*r)}function O(o,i){const e=o.get_sprite_state();i.previous<o.animation_timer+e.time||(o.animation_timer=i.previous,e.index++,e.loop?e.index===e.images.length&&(e.index=0):e.index===e.images.length&&(e.index=e.images.length-1,o.animation_end(o.animation_state)))}function T(o){o.is_moving=!1,o.is_backward=!1,o.is_forward=!1,o.forward=()=>{o.is_moving=!0,o.is_forward=!0,o.velocity.x=o.move_speed,o.is_jumping||o.animate("forward")},o.backward=()=>{o.is_moving=!0,o.is_backward=!0,o.velocity.x=-o.move_speed,o.is_jumping||o.animate("backward")},o.move_stop=()=>{o.velocity.x=0,o.is_moving=!1,o.is_backward=!1,o.is_forward=!1,o.is_jumping||o.animate("idle")};function i(){o.position.x+=o.velocity.x}o.hooks.update.push(i)}function $(o){const i=o.stage,e=o.stage.canvas,r=e.height-i.floor_height,s=r-110;o.is_grounded=!1,o.is_jumping=!1;let t="";o.jump=()=>{o.is_jumping=!0,o.is_grounded=!1,o.velocity.y=-o.jump_force;let c=o.get_direction();c==="forward"?o.animate("jump_forward"):c==="backward"?o.animate("jump_backward"):o.animate("jump")};function n(){t!=="jumping_up"&&(o.velocity.y>=i.gravity||(t="jumping_up"))}function a(){o.velocity.y<=i.gravity||(t="falling_down")}function d(){t!=="falling_down"||o.position.y+o.height<s||(t="landing",o.animate("landing"))}function u(){t==="landing"&&o.is_grounded&&(t="landed",o.is_jumping=!1,o.animate("land"),typeof o.on_land=="function"&&o.on_land())}function f(){n(),a(),d(),u()}function b(c){c==="land"&&o.animate("idle")}function v(c){c.beginPath(),c.moveTo(0,s),c.lineTo(e.width,s),c.moveTo(0,r),c.lineTo(e.width,r),c.stroke()}o.hooks.update.push(f),o.hooks.animation_end.push(b),o.hooks.draw.push(v)}function M(o){o.is_crouching=!1,o.crouch=()=>{o.is_crouching=!0,o.is_moving&&(o.velocity.x=0),o.animate("crouch"),o.set_hitbox_offset(38)},o.crouch_end=()=>{o.set_hitbox_offset(0)}}function q(o){o.hitbox={top:0,right:0,bottom:0,left:0,width:0,height:0},o.hitbox_offset={top:0,right:0,bottom:0,left:0};function i(s=0,t=0,n=0,a=0){o.hitbox_offset={top:s,right:t,bottom:n,left:a}}function e(){o.hitbox={top:o.position.y+o.hitbox_offset.top,right:o.position.x+o.width+o.hitbox_offset.right,bottom:o.position.y+o.height-o.hitbox_offset.bottom,left:o.position.x+o.hitbox_offset.left,width:o.width-o.hitbox_offset.left-o.hitbox_offset.right,height:o.height-o.hitbox_offset.top-o.hitbox_offset.bottom}}function r(s){s.save(),s.strokeStyle="red",s.strokeRect(o.hitbox.left,o.hitbox.top,o.hitbox.width,o.hitbox.height),s.restore()}o.set_hitbox_offset=i,o.hooks.update.push(e),o.hooks.draw.push(r)}function A(o){function i(e){e.strokeRect(o.position.x,o.position.y,o.width,o.height)}o.hooks.draw.push(i)}const p={P1:{KeyA:"backward",KeyD:"forward",KeyS:"crouch",Space:"jump",KeyJ:"attack_1",KeyK:"attack_2",KeyL:"attack_3"}};function I(o){const i={forward:!1,backward:!1,crouch:!1},e={forward:s,backward:n,crouch:u,jump:v,attack_1:c,attack_2:j,attack_3:E},r={forward_end:t,backward_end:a,crouch_end:f};function s(){i.forward=!0,!i.crouch&&o.forward()}function t(){i.forward=!1,d()}function n(){i.backward=!0,!i.crouch&&o.backward()}function a(){i.backward=!1,d()}function d(){return i.forward?(s(),!0):i.backward?(n(),!0):(o.move_stop(),!1)}function u(){i.crouch=!0,!o.is_jumping&&o.crouch()}function f(){i.crouch=!1,o.crouch_end(),d()}function b(){return i.crouch?(u(),!0):!1}function v(){o.is_jumping||(o.jump(),o.on_land=()=>{o.on_land=null,!b()&&d()})}function c(){}function j(){}function E(){}document.addEventListener("keydown",x=>{if(o.lock||!p[o.pid])return;const l=p[o.pid][x.code];typeof e[l]=="function"&&e[l]()}),document.addEventListener("keyup",x=>{if(o.lock||!p[o.pid])return;const l=p[o.pid][x.code];typeof r[l+"_end"]=="function"&&r[l+"_end"]()})}class C{constructor(){this.hooks={init:[],update:[],animation_end:[],draw:[]}}load_sprite(i){this.sprites_data=L(i)}init(i){this.width=this.sprites_data.width,this.height=this.sprites_data.height,this.pid=i.pid??"P1",this.animation_state="idle",this.animation_timer=0,this.position=i.position??{x:0,y:0},this.velocity={x:0,y:0},this.move_speed=3,this.jump_force=700,K(this),q(this),T(this),M(this),$(this),A(this),this.hooks.init.forEach(e=>e(this)),I(this)}update(i){this.hooks.update.forEach(e=>e(i))}draw(i){this.hooks.draw.forEach(e=>e(i))}get_sprite_state(){return this.sprites_data.states[this.animation_state]}animate(i){this.animation_state!==i&&(this.animation_state=i,this.sprites_data.states[this.animation_state].index=0)}animation_end(i){this.hooks.animation_end.forEach(e=>e(i))}get_direction(){return this.velocity.x>0?"forward":this.velocity.x<0?"backward":!1}}const F="spiderman",N="sprites/spiderman/MVC2_SpiderMan_",R=1,D={x:-280,y:-210},J=60,Q=80,V=640,z=480,B={idle:{loop:!0,indexes:[[159,167]]},forward:{loop:!0,indexes:[[169,180]]},backward:{loop:!0,indexes:[[180,169]]},jump:{indexes:[[198,195],[189,195]]},jump_forward:{indexes:[[200,210]]},jump_backward:{indexes:[[211,216]]},falling:{indexes:[[189,195]]},land:{indexes:[[196,199]]},landing:{indexes:[[193,199]]},crouch:{indexes:[[217,220]]},web_shoot_ground_up_right:{indexes:[[668,669]]}},G={id:F,base_src:N,scale:R,offset:D,width:J,height:Q,image_width:V,image_height:z,states:B};function H(o){o.stage.canvas;let i={shoot:!1,length:0,velocity:5,origin_offset:{x:25,y:-10}};o.web_swing=()=>{e()};function e(){o.lock=!0,o.move_stop(),o.animate("web_shoot_ground_up_right"),i.length=0,i.shoot=!0,i.angle=5.5,i.origin={x:o.position.x+o.width+i.origin_offset.x,y:o.position.y+i.origin_offset.y}}function r(a){if(!i.shoot)return;i.length+=i.velocity;let{length:d,angle:u,origin:f}=i;i.current={x:f.x+d*Math.cos(u),y:f.y+d*Math.sin(u)},s()}function s(){let a=500;console.log(i.length),!(i.length<a)&&(i.shoot=!1,o.lock=!1,o.animate("idle"))}function t(a){i.shoot&&(a.save(),a.strokeStyle="cyan",a.beginPath(),a.moveTo(i.origin.x,i.origin.y),a.lineTo(i.current.x,i.current.y),a.stroke(),a.restore())}function n(a){t(a)}o.hooks.update.push(r),o.hooks.draw.push(n)}const g={P1:{KeyK:"web_swing"}};function U(o){const i={web_swing:e};function e(){o.web_swing()}document.addEventListener("keydown",r=>{if(o.lock||!g[o.pid])return;let s=g[o.pid][r.code];typeof i[s]=="function"&&i[s]()}),document.addEventListener("keyup",r=>{if(o.lock||!g[o.pid])return;let s=g[o.pid][r.code];typeof i[s+"_end"]=="function"&&i[s+"_end"]()})}class W extends C{constructor(i={}){super(),this.load_sprite(G),this.hooks.init.push(()=>{H(this)}),U(this)}}const m={previous:0,seconds_passed:0};let h,_,w;function X(){oo(),Y(),requestAnimationFrame(k)}window.addEventListener("load",X);function Y(){w=new S(_),w.add_player(new W,{pid:"P1"})}function Z(o){w.update(o)}function y(o){o.clearRect(0,0,h.width,h.height),w.draw(o)}function oo(){h=document.querySelector("canvas"),h.width=1e3,h.height=500,_=h.getContext("2d"),_.strokeStyle="green",_.imageSmoothingEnabled=!0,_.imageSmoothingQuality="high"}function k(o){m.seconds_passed=(o-m.previous)/1e3,m.previous=o,requestAnimationFrame(k),Z(m),y(_)}
